# 🔧 故障排除指南

## 保存功能無法正常工作

如果您遇到編輯模板後無法保存的問題，請按照以下步驟進行診斷和修復：

### 第一步：檢查環境

1. **確認您是否有本地伺服器**
   - 如果您沒有 PHP 伺服器，請使用我們提供的 Node.js 測試伺服器

2. **啟動本地測試伺服器**
   ```bash
   node local-test-server.js
   ```

3. **確認伺服器正常運行**
   - 您應該看到類似以下的訊息：
   ```
   🚀 本地測試伺服器已啟動
   📡 伺服器地址: http://localhost:3000
   📁 數據文件: ./data/templates/template-data.json
   ```

### 第二步：使用診斷工具

1. **打開診斷工具**
   - 在瀏覽器中打開：`http://localhost:3000/debug-save-issue.html`

2. **執行完整診斷**
   - 點擊「執行完整診斷」按鈕
   - 查看診斷結果

3. **根據診斷結果採取行動**

### 第三步：常見問題和解決方案

#### 問題 1：API 連接失敗
**症狀**：診斷工具顯示「API 連接測試」失敗

**解決方案**：
- 確認本地伺服器正在運行
- 檢查瀏覽器控制台是否有錯誤訊息
- 確認 API 端點路徑正確

#### 問題 2：權限錯誤
**症狀**：保存時出現「權限被拒絕」錯誤

**解決方案**：
- 檢查 `data/templates/` 目錄的寫入權限
- 確保 PHP 或 Node.js 有權限寫入該目錄

#### 問題 3：CORS 錯誤
**症狀**：瀏覽器控制台顯示 CORS 相關錯誤

**解決方案**：
- 使用我們提供的本地測試伺服器
- 確認伺服器正確設置了 CORS 頭

#### 問題 4：數據格式錯誤
**症狀**：保存時出現「無效的 JSON 資料」錯誤

**解決方案**：
- 檢查模板資料是否包含所有必要欄位
- 確認資料格式正確

### 第四步：手動測試

如果診斷工具無法找出問題，您可以手動測試：

1. **測試獲取模板**
   ```bash
   curl http://localhost:3000/api/get-templates.php
   ```

2. **測試保存模板**
   ```bash
   curl -X POST http://localhost:3000/api/save-template.php \
     -H "Content-Type: application/json" \
     -d '{
       "id": "TEST_001",
       "code": "TEST_001",
       "category": "ic",
       "title": {"zh": "測試模板", "en": "Test Template"},
       "description": {"zh": "測試描述", "en": "Test Description"},
       "content": {"zh": "測試內容", "en": "Test Content"},
       "status": "active"
     }'
   ```

### 第五步：檢查日誌

1. **檢查伺服器日誌**
   - 查看終端機中的伺服器輸出
   - 尋找錯誤訊息

2. **檢查瀏覽器控制台**
   - 按 F12 打開開發者工具
   - 查看 Console 標籤中的錯誤訊息

3. **檢查網路請求**
   - 在開發者工具的 Network 標籤中
   - 查看 API 請求的狀態和回應

### 第六步：重置和重新開始

如果所有方法都無效：

1. **備份現有資料**
   ```bash
   cp data/templates/template-data.json data/templates/template-data.backup.json
   ```

2. **重新初始化**
   ```bash
   rm data/templates/template-data.json
   node local-test-server.js
   ```

3. **重新測試**
   - 使用診斷工具重新測試
   - 嘗試創建新模板

### 第七步：尋求幫助

如果問題仍然存在：

1. **收集診斷資訊**
   - 診斷工具的完整輸出
   - 瀏覽器控制台的錯誤訊息
   - 伺服器日誌

2. **記錄問題詳情**
   - 問題發生的具體步驟
   - 使用的瀏覽器和版本
   - 作業系統資訊

3. **聯繫支援**
   - 提供完整的診斷資訊
   - 描述您嘗試過的解決方案

## 其他常見問題

### 問題：favicon.ico 404 錯誤
**解決方案**：這已經在之前的修復中解決，如果仍有問題，請檢查：
- `.htaccess` 檔案是否存在
- `favicon.ico` 檔案是否存在
- 瀏覽器快取是否已清除

### 問題：頁面載入緩慢
**解決方案**：
- 檢查網路連接
- 清除瀏覽器快取
- 檢查是否有大量模板資料

### 問題：搜尋功能不工作
**解決方案**：
- 確認 JavaScript 已正確載入
- 檢查瀏覽器控制台是否有錯誤
- 確認模板資料格式正確

## 預防措施

1. **定期備份**
   - 定期備份 `data/templates/template-data.json`
   - 使用版本控制系統

2. **測試環境**
   - 在修改前先在測試環境中測試
   - 使用診斷工具定期檢查

3. **監控**
   - 定期檢查系統日誌
   - 監控 API 回應時間

## 技術支援

如果您需要進一步的技術支援，請提供：

1. **系統資訊**
   - 作業系統版本
   - 瀏覽器版本
   - Node.js 版本（如果使用）

2. **錯誤詳情**
   - 完整的錯誤訊息
   - 錯誤發生的時間和步驟
   - 相關的日誌檔案

3. **環境資訊**
   - 是否使用本地伺服器
   - 網路環境
   - 防火牆設定

---

**最後更新**：2025-06-23  
**版本**：1.0.0 